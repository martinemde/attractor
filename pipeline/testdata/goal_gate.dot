// Pipeline with goal gate enforcement on tests
digraph GoalGate {
    graph [goal="Create a hello world script", retry_target="plan"]

    start     [shape=Mdiamond]
    exit      [shape=Msquare]

    plan      [label="Plan", prompt="Plan how to create: $goal"]
    implement [label="Implement", prompt="Write the code", goal_gate=true, retry_target="plan"]
    review    [label="Review", prompt="Review the code for correctness"]

    start -> plan -> implement
    implement -> review   [condition="outcome=success"]
    implement -> plan     [condition="outcome=fail", label="Retry"]
    review -> exit        [condition="outcome=success"]
    review -> implement   [condition="outcome=fail", label="Fix"]
}
